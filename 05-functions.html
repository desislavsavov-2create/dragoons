<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>JS Learning - 04. Objects &amp; Arrays</title>
</head>
<body>

	<!-- FUNCTIONS -->


	<!-- 01 -->

	<h1>Clock</h1>

	<p id="clock">
		<span id="clockHours">00</span> : 
		<span id="clockMinutes">00</span> : 
		<span id="clockSeconds">00</span>
	</p>

	<script>
		(function() {
			'use strict';

			var doc = document;

			var clock = {
				hours: doc.getElementById('clockHours'),
				minutes: doc.getElementById('clockMinutes'),
				seconds: doc.getElementById('clockSeconds'),
				setTheTime: function() {
					var now = new Date();

					clock.hours.innerHTML = clock.padNumber(now.getHours());
					clock.minutes.innerHTML = clock.padNumber(now.getMinutes());
					clock.seconds.innerHTML = clock.padNumber(now.getSeconds());

					setTimeout(clock.setTheTime, 1000);
				},
				padNumber: function(num) {
					return num.toString().length < 2 ? '0' + num : num;
				},
				init: function() {
					clock.setTheTime();
				}
			};

			clock.init();

		})();
	</script>

	<!-- 02 -->

	<h1>Stopwatch</h1>

	<div id="stopwatch">
		<p>
			<span class="hours">00</span> : 
			<span class="minutes">00</span> : 
			<span class="seconds">00</span>
		</p>

		<div>
			<button class="start">Run</button>
			<button class="pause">Pause</button>
			<button class="reset">Reset</button>
		</div>
	</div><!-- /#stopwatch -->

	<h1>Stopwatch 2</h1>

	<div id="stopwatch2">
		<p>
			<span class="hours">00</span> : 
			<span class="minutes">00</span> : 
			<span class="seconds">00</span>
		</p>

		<div>
			<button class="start">Run</button>
			<button class="pause">Pause</button>
			<button class="reset">Reset</button>
		</div>
	</div><!-- /#stopwatch -->

	<script>
		(function() {
			'use strict';

			window.onload = function() {
				var Stopwatch = function(containerId) {
					var _this = this;

					_this.container = document.getElementById(containerId);

					_this.elapsed = 0;
					
					_this.seconds = _this.getElementByClass('seconds');
					_this.minutes = _this.getElementByClass('minutes');
					_this.hours = _this.getElementByClass('hours');

					_this.btnStart = _this.getElementByClass('start');
					_this.btnPause = _this.getElementByClass('pause');
					_this.btnReset = _this.getElementByClass('reset');

					_this.ticker = null;

					_this.btnStart.onclick = function () {
						_this.run();
					};
					_this.btnPause.onclick = function () {
						_this.pause();
					};
					_this.btnReset.onclick = function () {
						_this.reset();
					};

				};

				Stopwatch.prototype.getElementByClass = function(className) {
					return this.container.getElementsByClassName(className)[0];
				};

				Stopwatch.prototype.renderHTML = function(element, newHTML) {
					element.innerHTML = newHTML;
				};

				Stopwatch.zeroPad = function(num) {
					return num.toString().length < 2 ? '0' + num : num;
				};

				Stopwatch.prototype.run = function() {
					var _this = this;

					if(_this.ticker === null) {
						_this.updateVals();
						
						_this.ticker = setInterval(function() {
							_this.updateVals();
						}, 1000);
					}
				};

				Stopwatch.prototype.updateVals = function() {
					var _this = this;
					var elapsed = this.elapsed;
					var seconds, minutes, hours;

					seconds = elapsed % 60;
					minutes = Math.floor( ( elapsed / 60 ) % 60 );
					hours = Math.floor( elapsed / 3600 );

					_this.renderHTML(this.seconds, Stopwatch.zeroPad(seconds));
					_this.renderHTML(this.minutes, Stopwatch.zeroPad(minutes));
					_this.renderHTML(this.hours, Stopwatch.zeroPad(hours));

					this.elapsed++;
				};

				Stopwatch.prototype.pause = function() {
					var _this = this;

					clearInterval(this.ticker);
					this.ticker = null;
				};

				Stopwatch.prototype.reset = function() {
					this.pause();

					this.elapsed = 0;
					this.updateVals();
				};

				var stopwatch1 = new Stopwatch('stopwatch');
				var stopwatch1 = new Stopwatch('stopwatch2');
			}

		})();
	</script>

	<!-- Event Dispatcher -->

	<script>
		(function() {
			'use strict';

			var myActions = {};

			function addAction(action, callback) {
				if(typeof myActions[action] === 'undefined') {
					myActions[action] = [];
				}
				myActions[action].push(callback);
			}

			function doAction(action) {
				for( var i = 0; i < myActions[action].length; i++ ) {
					myActions[action][i]();
				}
			}

			addAction('test', function() {
				console.log('test was just called.');
			});

			addAction('test', function() {
				console.log('but test has two callbacks.');
			})

			doAction('test');

		})();
	</script>
</body>
</html>