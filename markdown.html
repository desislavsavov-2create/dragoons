<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	
	<title>Document</title>
	<script>
			window.onload=function(){
				var text = 'Lorem ipsum dolor sit *amet*, consectetur adipisicing elit. <http://google.com> lorem ipsum\n' +
					'#Heading 1 \n' + 
					'##Heading 2 \n' + 
					'###Heading 3 \n' + 
					'####Heading 4 \n' + 
					'#####Heading 5 \n' + 
					'######Heading 6 \n' +
					'--------- \n' +
					'* ul test 1 \n' +
					'* ul test 2 \n' +
					'* ul test 3 \n' +
					'* ul test 4 \n' +
					'----\n' +
					'##Ordered Lists \n' + 
					'0. ol test 1 \n' +
					'0. ol test 2 \n' +
					'0. ol test 3 \n' +
					'0. ol test 4 \n' +
					'test ------- mest \n' +
					'---- \n' +
					'`win.location = "http://google.com"` \n' +
					'---- \n' +
					'`win.location = ""`\n' +
					'---- \n' +
					'{{{code-block *not strong*}}}';

				function parseText(text) {
					// link
					text = text.replace(/<([^>]+)>/g, '<a href="$1">$1</a>');
					
					// lists
					function doLists(text, type, plainTextToken) {
						var lines = text.split(/\n|\r|\n\r|\r\n/);
						var listItemPrefix = new RegExp('^ *' + plainTextToken + ' *');
						var isInList = false;
						var result = [];
						var line;

						for (var i = 0; i < lines.length; i++) {
							line = lines[i];

							if(listItemPrefix.test(line)) {
								line = '<li>' + line.replace(listItemPrefix, '') + '</li>';

								if(!isInList) {
									line = '\n<' + type + '>' + line;
									isInList = true;
								}
							} else {
								if(isInList){
									line = '</' + type + '>\n' + line;

									isInList = false;
								}
							}

							result.push(line);
						}

						return result.join('\n');
					}

					text = doLists(text, 'ul', '\\*');
					text = doLists(text, 'ol', '\\d\\.');

					// strong
					text = text.replace(/\*([^*]+)\*/g, '<strong>$1</strong>');

					// headings
					text = text.replace(/^#{1,6}.*$/mg, function(match) {
						var pieces = match.match(/^(#{1,6})\s*(.*)/);
						var sharpsCount = pieces[1].length;
						var headingTag = 'h' + sharpsCount;
						var headingText = pieces[2];

						return '<' + headingTag + '>' + headingText + '</' + headingTag + '>';
					});

					// hr
					text = text.replace(/^-{4,} *$/mg, '<hr />');

					function code(text) {
						var uniqueString = Math.random().toString();

						text = text.replace(/\{{3}(.+?)\}{3}/, uniqueString);

						console.log(text);
						

						// replace {{{ lorem ipsum}}} with unique string

						// do parse text

						// replace unique string with output
					}

					text = code(text);

					// code
					text = text.replace(/`(.+?)`/g, '<code>$1</code>');

					// pre

					return text;
				}

				console.log(parseText(text));

				document.getElementById('result').innerHTML = parseText(text);
			};

	</script>
</head>

<body>
<div id="result"></div><!-- /#result -->
</body>
</html>