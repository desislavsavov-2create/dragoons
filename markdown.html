<script >
"use strict";

( function () {
	var string = '#lorem\n'+
	'##lorem\n'+
	'###lorem\n'+
	'####lorem\n'+
	'#####lorem\n'+
	'######lorem\n'+
	'Lorem ipsum dolor sit *amet*, consectetur adipisicing elit. Ex, iure, tempore. <http://google.com>: Tempore, fugit, repudiandae tempora quo id numquam cum dignissimos vel ratione eaque ut *ullam* error accusamus quidem iusto. Quidem!';

	var regex = /\*(.+?)\*/mg;
	var regexMail = /<htt(.*?)>/mg;
	var regexHead1 = /^#[^#](.*)?/mg;
	var regexHead2 = /^##[^#](.*)?/mg;
	var regexHead3 = /^###(.*)?/mg;

	string = string.replace(regexMail, '<a href="htt$1">htt$1</a>');
	string = string.replace(regex, '<strong>$1</strong>');
	// string = string.replace(regexHead1, '<h1>$1</h1>');
	// string = string.replace(regexHead2, '<h2>$1</h2>');
	// string = string.replace(regexHead3, '<h3>$1</h3>');
	string = string.replace(/^#{1,6}.*$/mg, function (match) {
		var pieces = match.match(/^(#{1,6})\s*(.*)/);
		var sharpsCount = pieces[1].length;
		var headingTag = 'h' + sharpsCount;

		var headingText = pieces[2];

		return '<' + headingTag + '>' + headingText + '</' + headingTag + '>'
	});

	// console.log( string );
})();

window.onload = function () {
	var string = ' * #lorem\n'+
	' * ##lorem\n'+
	' * ###lorem\n'+
	' * ####lorem\n'+
	' * #####lorem\n'+
	' * ######lorem\n'+
	'----\n'+
	'#lorem\n'+
	'##lorem\n'+
	'###lorem\n'+
	'----------\n'+
	'test ---------- mest \n'+
	' * #lorem\n'+
	' * ##lorem\n'+
	' * ###lorem\n'+
	' * ####lorem\n'+
	' * #####lorem\n'+
	'`win.location = "http://google.com"`\n'+
	'`win.location = ""`\n'+
	' * ######lorem\n'+
	'Lorem ipsum dolor sit *amet*, consectetur adipisicing elit. Ex, iure, tempore. <http://google.com>: Tempore, fugit, repudiandae tempora quo id numquam cum dignissimos vel ratione eaque ut *ullam* error accusamus quidem iusto. Quidem!';

	string = insertInTag(string);
	string = doLink(string);
	string = doHeading(string);
	string = doStrong(string);
	string = doList(string, 'ul');
	string = doLine(string);

	function doList (text, type) {
		var regex = /(^ \* .*$(\n|\r|\n\r|\r\n))+/mg;

		text = text.replace(regex, function (match) {
			match = match.replace(/^\s\*\s/gm, '').replace(/\s\*$/gm, '');

			var list = [];
			var items = match.split('\n');

			list.push('<' + type + '>\n');

			for ( var i = 0; i < items.length - 1 ; i++ ) {
				list.push('\t<li>' + items[i] + '</li>\n');
			}

			list.push('</' + type + '>\n');		

			return list.join("");

		});

		return text;		
	}

	function doLine (text) {
		var regex = /^-{4,}$/gm;

		text = text.replace(regex, '<hr />')
		return text;
	}

	function doStrong (text) {
		var regex = /\*(.+?)\*/mg;

		return text = text.replace(regex, '<strong>$1</strong>');
	}

	function doHeading (text) {
		text = text.replace(/^#{1,6}.*$/mg, function (match) {

			var pieces = match.match(/^(#{1,6})\s*(.*)/);
			var sharpsCount = pieces[1].length;
			var headingTag = 'h' + sharpsCount;

			var headingText = pieces[2];

			return '<' + headingTag + '>' + headingText + '</' + headingTag + '>'
		});


		return text;
	}

	function doLink (text) {
		text = text.replace(/<htt(.*?)>/mg, '<a href="htt$1">htt$1</a>');
		return text;
	}

	function insertInTag (text) {
		text = text.replace(/`(.*?)`/g, '<code>$1</code>');

		return text;
	}

	console.log(string)
};



</script>